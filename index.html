<!DOCTYPE html>
<html lang="pl">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Collage, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
      text-align: center;
    }
    .hidden { display: none; }
    .container { margin-top: 40px; }
    .login-box input {
      display: block;
      margin: 10px auto;
      padding: 8px;
      width: 200px;
      border-radius: 6px;
      border: none;
    }
    button {
      padding: 8px 16px;
      border: none;
      background: red;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button[disabled] {
      background: gray !important;
      cursor: default;
    }
    .card {
      border: 1px solid #555;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      background: #111;
    }
    .lista-zapisanych {
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      padding: 8px;
      margin-top: 6px;
      text-align: left;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    #wersjaApki {
      position: fixed;
      top: 8px;
      right: 12px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
      user-select: none;
      z-index: 1000;
    }
    button.loading {
      background: #222 !important;
      opacity: 0.6;
      pointer-events: none;
      transition: background 0.2s ease, opacity 0.2s ease;
    }

    /* SPLASH */
    #splash {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
    }
    .logo-fadein {
      width: 300px;
      opacity: 0;
      filter: brightness(20%) blur(2px);
      transform: scale(0.2);
      animation: wjazdLogo 5s ease-out forwards;
    }
    @keyframes wjazdLogo {
      0%   { opacity: 0; transform: scale(0.2); filter: brightness(20%) blur(4px); }
      60%  { opacity: 1; transform: scale(1.1); filter: brightness(160%) blur(0); }
      85%  { opacity: 1; transform: scale(1); filter: brightness(100%); }
      100% { opacity: 0; transform: scale(1); filter: brightness(50%) blur(2px); }
    }

    .full-btn {
      display: block;
      width: 200px;
      margin: 10px auto;
      padding: 8px;
      border-radius: 6px;
      background: red;
      border: none;
      color: white;
      cursor: pointer;
    }
    .full-btn.alt { background: #333; }
  </style>

  <script>
    const WERSJA_APKI = '1.53.63';  // ‚Üê AKTUALNE
    const poprzednia = localStorage.getItem('wersjaApki');

    if (poprzednia !== WERSJA_APKI) {
      localStorage.setItem('wersjaApki', WERSJA_APKI);
      location.reload(true);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(e => {});
    }
  </script>
</head>

<body>
<div id="wersjaApki">v<span id="wersjaNum"></span></div>

<div id="splash">
  <img src="icon-512.png" class="logo-fadein">
</div>

<div id="app" class="hidden">

  <!-- LOGOWANIE -->
  <div id="loginView" class="container">
    <img src="https://i.imgur.com/41PSyW5.jpeg" style="width:200px;margin-bottom:20px;">
    <h1>Logowanie</h1>
    <div class="login-box">
      <input id="numer" type="text" placeholder="Numer / Inicja≈Çy">
      <input id="haslo" type="password" placeholder="Has≈Ço">
      <button class="full-btn" onclick="zaloguj()">Zaloguj</button>
      <button class="full-btn alt" onclick="pokazRejestracjaSelect()">Rejestracja</button>
    </div>
    <p id="komunikat"></p>
  </div>

    <!-- WYB√ìR TYP REJESTRACJI -->
  <div id="registerSelectView" class="container hidden">
    <h1>Rejestracja</h1>
    <button class="full-btn" onclick="pokazRejestracjaZawodnik()">Zawodnik</button>
    <button class="full-btn" onclick="pokazRejestracjaTrener()">Trener</button>
    <button class="full-btn alt" onclick="pokazLogowanie()">‚¨Ö Powr√≥t</button>
  </div>

  <!-- REJESTRACJA ZAWODNIKA -->
  <div id="registerZawodnikView" class="container hidden">
    <h1>Rejestracja zawodnika</h1>
    <div class="login-box">
      <input id="regNumer" type="number" placeholder="Numer zawodnika">
      <input id="regNazwisko" type="text" placeholder="Imiƒô i nazwisko">
      <input id="regHaslo" type="password" placeholder="Ustaw has≈Ço">
      <button class="full-btn" onclick="wyslijRejestracje()">Zarejestruj</button>
    </div>
    <p id="regMsg"></p>
    <button class="full-btn alt" onclick="pokazRejestracjaSelect()">‚¨Ö Powr√≥t</button>
  </div>

  <!-- REJESTRACJA TRENERA -->
  <div id="rejestracjaTrenerView" class="container hidden">
    <h1>Rejestracja trenera</h1>
    <div class="login-box">
      <input id="regNazwiskoTrener" type="text" placeholder="Imiƒô i nazwisko">
      <input id="regHasloTrener" type="password" placeholder="Ustaw has≈Ço">
      <button class="full-btn" onclick="wyslijRejestracjeTrener()">Zarejestruj</button>
      <button class="full-btn alt" onclick="pokazRejestracjaSelect()">‚¨Ö Powr√≥t</button>
    </div>
    <p id="regMsgTrener"></p>
  </div>

  <!-- PANEL TRENERA -->
  <div id="trainerPanelView" class="container hidden">
    <h1>Panel trenera</h1>
    <button class="full-btn" onclick="trainerPokazZawodnicy()">üë• Zawodnicy</button>
    <button class="full-btn" onclick="trainerPokazWydarzenia()">üèí Wydarzenia</button>
    <button class="full-btn alt" onclick="pokazLogowanie()">‚¨Ö Wyloguj</button>
  </div>

  <!-- LISTA ZAWODNIK√ìW -->
  <div id="trainerZawodnicyView" class="container hidden">
    <h1>Lista zawodnik√≥w</h1>
    <div id="trainerListaZawodnikow">≈Åadowanie...</div>
    <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
  </div>

  <!-- WYDARZENIA TRENERA -->
  <div id="trainerWydarzeniaView" class="container hidden">
    <h1>Wydarzenia</h1>
    <div id="trainerListaWydarzen">≈Åadowanie...</div>

    <button class="full-btn" style="margin-top:20px;" onclick="pokazDodajWydarzenie()">
      ‚ûï Dodaj wydarzenie
    </button>

    <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
  </div>

  <!-- DODAJ WYDARZENIE -->
  <div id="trainerDodajWydarzenieView" class="container hidden">
    <h1>Dodaj wydarzenie</h1>

    <div class="login-box">
      <input id="eventData" type="date" placeholder="Data">
      <input id="eventStart" type="time" placeholder="Godzina startu">
      <input id="eventEnd" type="time" placeholder="Godzina zako≈Ñczenia">
      <input id="eventRodzaj" type="text" placeholder="Rodzaj wydarzenia">

      <select id="eventTrener1" style="width:200px;">
        <option value="">‚Äî wybierz ‚Äî</option>
      </select>

      <select id="eventTrener2" style="width:200px;">
        <option value="">‚Äî brak ‚Äî</option>
      </select>

      <select id="eventGrupy" multiple style="width:200px; height:110px;">
        <option value="G1">G1</option>
        <option value="G2">G2</option>
        <option value="G3">G3</option>
        <option value="G4">G4</option>
        <option value="G5">G5</option>
      </select>

      <label style="display:block;margin-top:10px;">
        <input id="eventStat" type="checkbox"> Liczyƒá do statystyk
      </label>
    </div>

    <button class="full-btn" onclick="wyslijNoweWydarzenie()">üíæ Dodaj wydarzenie</button>
    <button class="full-btn alt" onclick="trainerPokazWydarzenia()">‚¨Ö Powr√≥t</button>

    <p id="eventMsg" style="margin-top:10px;"></p>
  </div>

  <!-- P≈ÅATNO≈öCI -->
  <div id="platnosciView" class="container hidden">
    <h1>P≈Çatno≈õci</h1>
    <div id="listaPlatnosci">≈Åadowanie...</div>
  </div>

  <!-- WYDARZENIA ZAWODNIKA -->
  <div id="homeView" class="container hidden">
    <h1 id="tytulTreningow">TWOJE WYDARZENIA</h1>
    <div id="listaTreningow">≈Åadowanie...</div>
    <button onclick="pokazStatystyki()" style="margin-top:20px;">üìà Poka≈º statystyki</button>
    <button onclick="powrotDoPlatnosci()" style="margin-top:10px;background:#333;">‚¨Ö Powr√≥t do p≈Çatno≈õci</button>
  </div>

  <!-- STATYSTYKI -->
  <div id="statsView" class="container hidden">
    <h1>Moje statystyki</h1>
    <div id="listaStatystyk">≈Åadowanie...</div>
    <button onclick="powrotDoTreningow()" style="margin-top:20px;">‚¨Ö Powr√≥t</button>
  </div>

  <script>

/* =================== USTAWIENIA APLIKACJI =================== */

const WERSJA_APKI = '1.51.63';
const poprzednia = localStorage.getItem('wersjaApki');
if (poprzednia !== WERSJA_APKI) {
  localStorage.setItem('wersjaApki', WERSJA_APKI);
  location.reload(true);
}

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(r => console.log("SW OK", r))
    .catch(e => console.error("SW ERR:", e));
}


/* =================== GLOBALNE =================== */

const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycby8fW026DVgjt4b_xwzvgyGyLlWedonFz6GxVjTmcqTKT7sqGpAFsNdf7gC025UtiCU/exec";

let numerZalogowanego = null;
let grupaZalogowanego = null;
window.grupyTrenera = "";


/* =================== SPLASH + D≈πWIƒòK =================== */

function odtworzIntroSound() {
  try {
    const audio = new Audio("sound.mp3");
    audio.volume = 0.7;
    audio.play().catch(() => {});
  } catch (e) {}
}

window.addEventListener("load", () => {
  odtworzIntroSound();
  setTimeout(() => {
    document.getElementById("splash").style.display = "none";
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("wersjaNum").textContent = WERSJA_APKI;
  }, 5000);
});


/* =================== NAWIGACJA =================== */

function ukryjWszystkie() {
  document.querySelectorAll(".container").forEach(v => v.classList.add("hidden"));
}

function pokazLogowanie() {
  ukryjWszystkie();
  document.getElementById("loginView").classList.remove("hidden");
}

function pokazRejestracjaSelect() {
  ukryjWszystkie();
  document.getElementById("registerSelectView").classList.remove("hidden");
}

function pokazRejestracjaZawodnik() {
  ukryjWszystkie();
  document.getElementById("registerZawodnikView").classList.remove("hidden");
}

function pokazRejestracjaTrener() {
  ukryjWszystkie();
  document.getElementById("rejestracjaTrenerView").classList.remove("hidden");
}


/* =================== LOGOWANIE =================== */

async function zaloguj() {
  const login = document.getElementById("numer").value.trim();
  const haslo = document.getElementById("haslo").value.trim();
  const komunikat = document.getElementById("komunikat");

  if (!login || !haslo) {
    komunikat.innerText = "Podaj login i has≈Ço.";
    return;
  }

  komunikat.innerText = "Logowanie...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({ mode: "login", numer: login, haslo })
    });

    const data = await res.json();
    if (!data.success) {
      komunikat.innerText = "‚ùå " + (data.message || "B≈ÇƒÖd logowania");
      return;
    }

    komunikat.innerText = "‚úÖ OK";

    // ZAWODNIK
    if (data.role === "zawodnik") {
      numerZalogowanego = data.login;
      grupaZalogowanego = data.grupa || "";
      ukryjWszystkie();
      document.getElementById("platnosciView").classList.remove("hidden");

      const platnosci =
        await (await fetch(`${SCRIPT_URL}?action=platnosci&numer=${encodeURIComponent(numerZalogowanego)}`)).json();

      renderPlatnosci(platnosci);
      return;
    }

    // TRENER
    if (data.role === "trener") {
      window.grupyTrenera = data.grupa || "";
      ukryjWszystkie();
      document.getElementById("trainerPanelView").classList.remove("hidden");
      return;
    }

  } catch (e) {
    komunikat.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia.";
  }
}


/* =================== PANEL TRENERA =================== */

function trainerPowrot() {
  ukryjWszystkie();
  document.getElementById("trainerPanelView").classList.remove("hidden");
}


async function trainerPokazZawodnicy() {
  ukryjWszystkie();
  document.getElementById("trainerZawodnicyView").classList.remove("hidden");

  const box = document.getElementById("trainerListaZawodnikow");
  box.innerHTML = "<div class='card' style='background:#222;'>≈Åadowanie...</div>";

  try {
    const res = await fetch(`${SCRIPT_URL}?action=statystykiSum`, { cache: "no-store" });
    const lista = await res.json();

    if (!lista?.length) {
      box.innerHTML = "<div class='card'>Brak danych</div>";
      return;
    }

    box.innerHTML = lista.map(z => `
      <div class="card" style="text-align:left;">
        <b>#${z.nr}</b> ‚Äî ${z.nazwisko}<br>
        <span style="opacity:0.8;">${z.suma} trening√≥w</span>
      </div>`).join("");

  } catch (e) {
    box.innerHTML = "<div class='card' style='background:#700;'>B≈ÇƒÖd</div>";
  }
}


async function trainerPokazWydarzenia() {
  ukryjWszystkie();
  document.getElementById("trainerWydarzeniaView").classList.remove("hidden");

  const grupa = encodeURIComponent(window.grupyTrenera || "");
  const res = await fetch(`${SCRIPT_URL}?action=treningiTrener&grupa=${grupa}`);
  const lista = await res.json();

  renderTreningiTrainer(lista);
}


function renderTreningiTrainer(lista) {
  const div = document.getElementById("trainerListaWydarzen");

  if (!lista?.length) {
    div.innerHTML = "<p>Brak wydarze≈Ñ</p>";
    return;
  }

  div.innerHTML = lista.map(t => `
    <div class="card">
      <b>${t.rodzaj}</b> ‚Äî ${t.data} (${t.dzien})<br>
      ${t.godzStart}‚Äì${t.godzKoniec}<br>
      Trener: <b>${t.trener}</b> ‚Äî Zapisanych: ${t.zapisanych}<br><br>
      <button class="btn" onclick="trainerToggleZapisani('${t.id}')">üë• Zapisani</button>
      <div id="trainer-zapisani-${t.id}" class="hidden"></div>
    </div>
  `).join("");
}


async function trainerToggleZapisani(id) {
  const box = document.getElementById(`trainer-zapisani-${id}`);
  if (!box) return;

  if (!box.classList.contains("hidden")) {
    box.classList.add("hidden");
    return;
  }

  box.classList.remove("hidden");
  box.innerHTML = "<div class='card' style='background:#222;'>≈Åadowanie...</div>";

  try {
    const res = await fetch(`${SCRIPT_URL}?action=zapisani&treningId=${id}`);
    const lista = await res.json();

    if (!lista?.length) {
      box.innerHTML = "<div class='card'>Brak</div>";
      return;
    }

    box.innerHTML = `
      <div class='card'>
        <b>Lista zapisanych:</b>
        <ul style="list-style:none;padding-left:0;margin-top:6px;">
          ${lista.map(p => `<li>${p.nazwisko}</li>`).join("")}
        </ul>
      </div>`;
  } catch (e) {
    box.innerHTML = "<div class='card' style='background:#700;'>B≈ÇƒÖd</div>";
  }
}


/* =================== ≈ÅADOWANIE LISTY TRENER√ìW =================== */

async function zaladujListeTrenerow() {
  try {
    const res = await fetch(`${SCRIPT_URL}?action=getTrenerzy`);
    const lista = await res.json();

    const t1 = document.getElementById("eventTrener1");
    const t2 = document.getElementById("eventTrener2");

    t1.innerHTML = "<option value=''>‚Äî wybierz ‚Äî</option>";
    t2.innerHTML = "<option value=''>‚Äî brak ‚Äî</option>";

    lista.forEach(n => {
      t1.innerHTML += `<option value="${n}">${n}</option>`;
      t2.innerHTML += `<option value="${n}">${n}</option>`;
    });

  } catch (err) {
    console.error("B≈ÇƒÖd trener√≥w:", err);
  }
}

function pokazDodajWydarzenie() {
  ukryjWszystkie();
  document.getElementById("trainerDodajWydarzenieView").classList.remove("hidden");
  zaladujListeTrenerow();
}


/* =================== DODAWANIE WYDARZENIA =================== */

function validHour(h) {
  return /^\d{2}:\d{2}$/.test(h);
}

async function wyslijNoweWydarzenie() {

  const data = document.getElementById("eventData").value;
  const start = document.getElementById("eventStart").value;
  const end = document.getElementById("eventEnd").value;
  const rodzaj = document.getElementById("eventRodzaj").value;
  const trener1 = document.getElementById("eventTrener1").value;
  const trener2 = document.getElementById("eventTrener2").value;

  const grupy = [...document.querySelectorAll("#eventGrupy option:checked")]
    .map(o => o.value)
    .join(",");

  const liczDoStat = document.getElementById("eventStat").checked;
  const msg = document.getElementById("eventMsg");

  if (!data || !start || !rodzaj || !trener1) {
    msg.innerText = "Wype≈Çnij wymagane pola.";
    return;
  }

  if (!validHour(start) || !validHour(end)) {
    msg.innerText = "Niepoprawna godzina.";
    return;
  }

  if (start >= end) {
    msg.innerText = "Godzina zako≈Ñczenia > rozpoczƒôcia.";
    return;
  }

  msg.innerText = "Dodawanie...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({
        action: "dodajWydarzenie",
        data,
        godzStart: start,
        godzKoniec: end,
        rodzaj,
        trener1,
        trener2,
        grupy,
        liczDoStatystyk: liczDoStat
      })
    });

    const r = await res.json();
    msg.innerText = r.message || "OK";

    if (r.success) {
      document.querySelectorAll("#trainerDodajWydarzenieView input")
        .forEach(i => { if (i.type === "checkbox") i.checked = false; else i.value = ""; });

      setTimeout(() => trainerPokazWydarzenia(), 600);
    }

  } catch (e) {
    msg.innerText = "B≈ÇƒÖd: " + e;
  }
}


/* =================== RENDER P≈ÅATNO≈öCI =================== */

function renderPlatnosci(lista) {
  const div = document.getElementById("listaPlatnosci");

  if (!lista?.length) {
    div.innerHTML = `
      <p>Brak zaleg≈Ço≈õci</p>
      <button class='full-btn' onclick='pokazTreningi()'>Dalej ‚û°</button>`;
    return;
  }

  div.innerHTML =
    `<h3>Zaleg≈Çe p≈Çatno≈õci:</h3>` +
    lista.map(p => `<div class='card' style='background:#a00;'>${p.nazwa} ‚Äì ${p.kwota} z≈Ç</div>`).join("") +
    `<button class='full-btn' onclick='pokazTreningi()'>Dalej ‚û°</button>`;
}


/* =================== WYDARZENIA ZAWODNIKA =================== */

async function pokazTreningi() {
  document.getElementById("platnosciView").classList.add("hidden");
  document.getElementById("homeView").classList.remove("hidden");

  const url = `${SCRIPT_URL}?action=treningi&grupa=${encodeURIComponent(grupaZalogowanego)}&numer=${encodeURIComponent(numerZalogowanego)}`;
  const lista = await (await fetch(url)).json();

  renderTreningi(lista);
}

function renderTreningi(lista) {
  const div = document.getElementById("listaTreningow");

  if (!lista?.length) {
    div.innerHTML = "<p>Brak wydarze≈Ñ</p>";
    return;
  }

  div.innerHTML = lista.map(t => `
    <div class="card">
      <b>${t.rodzaj}</b> ‚Äî ${t.data} (${t.dzien})<br>
      ${t.godzStart}‚Äì${t.godzKoniec}<br>
      Trener: <b>${t.trener}</b><br>
      Zapisanych: ${t.zapisanych}<br><br>

      <div style="display:flex;justify-content:center;gap:8px;">
        <button id="btn-${t.id}" ${t.zapisany ? "disabled" : ""} onclick="zapiszSie('${t.id}')">
          ${t.zapisany ? "Zapisano" : "Zapisz siƒô"}
        </button>

        <button id="wypisz-${t.id}" ${t.zapisany ? "" : "disabled"} style="background:#444;" onclick="wypiszSie('${t.id}')">
          Wypisz siƒô
        </button>

        <button style="background:#333;" onclick="toggleZapisani('${t.id}')">üë• Zapisani</button>
      </div>

      <div id="zapisani-${t.id}" class="hidden lista-zapisanych"></div>
    </div>`).join("");
}


/* =================== ZAPISYWANIE / WYPISYWANIE =================== */

async function zapiszSie(id) {
  const btn = document.getElementById(`btn-${id}`);
  const wypiszBtn = document.getElementById(`wypisz-${id}`);
  const box = document.getElementById(`zapisani-${id}`);

  btn.classList.add("loading");

  try {
    const res = await fetch(`${SCRIPT_URL}?action=zapisz&numer=${numerZalogowanego}&treningId=${id}`);
    const r = await res.json();

    if (r.ok) {
      btn.innerText = "Zapisano";
      btn.disabled = true;
      wypiszBtn.disabled = false;

      if (!box.classList.contains("hidden")) await odswiezListeZapisanych(id);
    }

  } catch (e) {
    alert("B≈ÇƒÖd: " + e);
  } finally {
    btn.classList.remove("loading");
  }
}

async function wypiszSie(id) {
  const wypiszBtn = document.getElementById(`wypisz-${id}`);
  const zapiszBtn = document.getElementById(`btn-${id}`);
  const box = document.getElementById(`zapisani-${id}`);

  wypiszBtn.classList.add("loading");

  try {
    const res = await fetch(`${SCRIPT_URL}?action=wypisz&numer=${numerZalogowanego}&treningId=${id}`);
    const r = await res.json();

    if (r.ok) {
      zapiszBtn.disabled = false;
      zapiszBtn.innerText = "Zapisz siƒô";
      wypiszBtn.disabled = true;

      if (!box.classList.contains("hidden")) await odswiezListeZapisanych(id);
    }

  } catch (e) {
    alert("B≈ÇƒÖd: " + e);
  } finally {
    wypiszBtn.classList.remove("loading");
  }
}

async function toggleZapisani(id) {
  const box = document.getElementById(`zapisani-${id}`);

  if (!box.classList.contains("hidden")) {
    box.classList.add("hidden");
    return;
  }

  box.classList.remove("hidden");
  box.innerHTML = "<div class='card' style='background:#222;'>≈Åadowanie...</div>";

  try {
    const res = await fetch(`${SCRIPT_URL}?action=zapisani&treningId=${id}`);
    const lista = await res.json();

    if (!lista?.length) {
      box.innerHTML = "<div class='card'>Brak</div>";
      return;
    }

    box.innerHTML = `
      <div class='card'>
        <b>Lista zapisanych:</b>
        <ul style="margin-top:6px;padding-left:0;list-style:none;">
          ${lista.map(p => `<li>${p.nazwisko}</li>`).join("")}
        </ul>
      </div>`;

  } catch (e) {
    box.innerHTML = "<div class='card' style='background:#700;'>B≈ÇƒÖd</div>";
  }
}

async function odswiezListeZapisanych(id) {
  const box = document.getElementById(`zapisani-${id}`);
  if (!box) return;

  box.innerHTML = "<div class='card' style='background:#222;'>Od≈õwie≈ºanie...</div>";

  try {
    const res = await fetch(`${SCRIPT_URL}?action=zapisani&treningId=${id}`);
    const lista = await res.json();

    if (!lista?.length) {
      box.innerHTML = "<div class='card'>Brak</div>";
      return;
    }

    box.innerHTML = `
      <div class='card'>
        <b>Lista zapisanych:</b>
        <ul style="margin-top:6px;padding-left:0;list-style:none;">
          ${lista.map(p => `<li>${p.nazwisko}</li>`).join("")}
        </ul>
      </div>`;

  } catch {
    box.innerHTML = "<div class='card' style='background:#700;'>B≈ÇƒÖd</div>";
  }
}


/* =================== STATYSTYKI =================== */

async function pokazStatystyki() {
  document.getElementById("homeView").classList.add("hidden");
  document.getElementById("statsView").classList.remove("hidden");

  const res = await fetch(`${SCRIPT_URL}?action=statystyki&numer=${numerZalogowanego}`);
  const lista = await res.json();

  renderStatystyki(lista);
}

function renderStatystyki(lista) {
  const div = document.getElementById("listaStatystyk");

  if (!lista?.length) {
    div.innerHTML = "<p>Brak danych</p>";
    return;
  }

  const suma = lista.reduce((acc, s) => acc + Number(s.treningi || 0), 0);

  div.innerHTML =
    lista.map(s => `<div class="card">üìÖ ${s.miesiac} ‚Äî ${s.treningi} trening√≥w</div>`).join("") +
    `<div class="card" style="background:#222;margin-top:20px;font-weight:bold;">
      ≈ÅƒÖcznie: ${suma} trening√≥w
    </div>`;
}

function powrotDoTreningow() {
  document.getElementById("statsView").classList.add("hidden");
  document.getElementById("homeView").classList.remove("hidden");
}

function powrotDoPlatnosci() {
  document.getElementById("homeView").classList.add("hidden");
  document.getElementById("platnosciView").classList.remove("hidden");
}


/* =================== REJESTRACJE =================== */

async function wyslijRejestracje() {
  const numer = document.getElementById("regNumer").value.trim();
  const nazwisko = document.getElementById("regNazwisko").value.trim();
  const haslo = document.getElementById("regHaslo").value.trim();
  const msg = document.getElementById("regMsg");

  if (!numer || !nazwisko || !haslo) {
    msg.innerText = "Wype≈Çnij wszystkie pola.";
    return;
  }

  msg.innerText = "Rejestracja...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({ mode: "rejestracja", numer, nazwisko, haslo })
    });

    const data = await res.json();

    if (data.ok) {
      msg.innerText = "Zarejestrowano!";
      setTimeout(() => { msg.innerText = ""; pokazLogowanie(); }, 1500);
    } else {
      msg.innerText = "B≈ÇƒÖd: " + (data.msg || "");
    }

  } catch (e) {
    msg.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia";
  }
}


async function wyslijRejestracjeTrener() {
  const nazwisko = document.getElementById("regNazwiskoTrener").value.trim();
  const haslo = document.getElementById("regHasloTrener").value.trim();
  const msg = document.getElementById("regMsgTrener");

  if (!nazwisko || !haslo) {
    msg.innerText = "Wype≈Çnij wszystkie pola.";
    return;
  }

  msg.innerText = "Rejestracja...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: new URLSearchParams({ mode: "rejestracjaTrener", nazwisko, haslo })
    });

    const data = await res.json();

    if (data.ok) {
      const inic = data.inic || "(?)";
      msg.innerHTML = `
        Zarejestrowano!<br>
        Login: <b>${inic}</b><br>
        <button class='full-btn' onclick="navigator.clipboard.writeText('${inic}')">Kopiuj login</button>
      `;
      setTimeout(() => { pokazLogowanie(); }, 3000);
    } else {
      msg.innerText = "B≈ÇƒÖd: " + (data.msg || "");
    }

  } catch (e) {
    msg.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia";
  }
}

</script>

  </body>
</html>
